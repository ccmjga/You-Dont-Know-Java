# ã€Šä½ ä¸çŸ¥é“çš„ JAVA ç³»åˆ—åšå®¢ã€‹ğŸ’˜ ä»ç™»å½•ä¸è®¤è¯çš„å•å…ƒæµ‹è¯•è¯´èµ·

## ä¸è¦å…¨éƒ¨ä½¿ç”¨ @SpringBootTest

ä½¿ç”¨ `@SpringBootTest` è¿›è¡Œå•å…ƒæµ‹è¯•ä¼šå¯åŠ¨æ•´ä¸ª Spring Boot å®¹å™¨ï¼Œå¹¶å¼•å…¥æ•´ä¸ªé¡¹ç›®çš„ `development&test` ä¾èµ–ã€‚ç¼ºç‚¹æ˜¯é€Ÿåº¦æ…¢ã€ä½“ç§¯å¤§ã€æµ‹è¯•ç›®æ ‡ä¸æ˜ç¡®ã€ä½å†…èšé«˜è€¦åˆã€‚

æ˜ç¡®æˆ‘ä»¬è¦æµ‹è¯•çš„ç›®æ ‡æ˜¯ç™»å½•åŠŸèƒ½ï¼Œæ‰€ä»¥åªè¦å¯åŠ¨ Spring Mvc çš„ä¾èµ–èŒƒå›´å°±å¯ä»¥äº†ï¼Œå…¶ä»–å±‚é¢çš„ä¾èµ–å¯ä»¥ç”¨ã€Œæ‰“æ¡©ã€æ¥è§£å†³ã€‚

## ä½¿ç”¨ @WebMvcTest

æ‰€ä»¥åªéœ€è¦éš”ç¦»å¯åŠ¨ Spring Mvc ç¯å¢ƒï¼Œå³å¯å®Œæˆç™»å½•åŠŸèƒ½çš„æµ‹è¯•äº†ã€‚

```java
@WebMvcTest(value = {SignController.class})
@Import({HttpFireWallConfig.class})
class SignMvcTest {

  @MockBean private SignService signService;

  @MockBean private CookieJwt cookieJwt;

  @Autowired private MockMvc mockMvc;

  @Test
  @WithMockUser
  void signIn_givenValidHttpRequest_shouldSucceedWith200() throws Exception {
    String stubUsername = "test_04cb017e1fe6";
    String stubPassword = "test_567472858b8c";
    SignInDto signInDto = new SignInDto();
    signInDto.setUsername(stubUsername);
    signInDto.setPassword(stubPassword);

    when(signService.signIn(signInDto)).thenReturn(1L);
    mockMvc
        .perform(
            post("/auth/sign-in")
                .contentType(MediaType.APPLICATION_JSON)
                .content(
                    """
                {
                  "username": "test_04cb017e1fe6",
                  "password": "test_567472858b8c"
                }
                 """)
                .with(csrf()))
        .andExpect(status().isOk());
  }

 @Test
  @WithMockUser
  void signIn_givenInValidHttpRequest_shouldFailedWith400() throws Exception {
    String stubUsername = "test_04cb017e1fe6";
    String stubPassword = "test_567472858b8c";
    SignInDto signInDto = new SignInDto();
    signInDto.setUsername(stubUsername);
    signInDto.setPassword(stubPassword);

    when(signService.signIn(signInDto)).thenReturn(1L);
    mockMvc
        .perform(
            post("/auth/sign-in")
                .contentType(MediaType.APPLICATION_FORM_URLENCODED)
                .content(
                    """
                   {
                     "username": "test_04cb017e1fe6",
                     "password": "test_567472858b8c"
                   }
                    """)
                .with(csrf()))
        .andExpect(status().isBadRequest());

    when(signService.signIn(signInDto)).thenReturn(1L);
    mockMvc
        .perform(
            post("/auth/sign-in")
                .contentType(MediaType.APPLICATION_JSON)
                .content(
                    """
                       {
                         "username": "test_04cb017e1fe6"
                       }
                        """)
                .with(csrf()))
        .andExpect(status().isBadRequest());
  }
}
```

## ä¸¥æ ¼æ¥è¯´ï¼Œä¸Šé¢æ˜¯ä¸€ä¸ªç»“åˆæµ‹è¯•

å•å…ƒæµ‹è¯•çš„æ¡†æ¶ä½“ç³»ä¸€èˆ¬åˆ†ä¸ºä¸‰ç§ ï¼š

* e2e (æ¥å£)æµ‹è¯•
* ç»“åˆæµ‹è¯•
* æ–¹æ³•(å•å…ƒ)æµ‹è¯•

ä¸Šé¢çš„æ¡ˆä¾‹æ˜¯ä¸€ä¸ªå…¸å‹çš„ç»“åˆæµ‹è¯•ã€‚å¦‚ä½•åŒºåˆ†è¿™äº›ä¸åŒçš„æµ‹è¯•å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æŒ‰ç…§ä¾èµ–èŒƒå›´ã€‚ç»“åˆæµ‹è¯•ä¸€èˆ¬ä¼šä¾èµ–æŸç§ç‰¹å®šçš„ç¯å¢ƒï¼Œé’ˆå¯¹æŸç§ç‰¹å®šç¯å¢ƒä¸‹çš„ä»£ç çš„ä¸šåŠ¡è¡¨ç°è¿›è¡Œæµ‹è¯•ï¼ŒSpringMvc å°±æ˜¯ä¸€ç§å…¸å‹çš„åœºæ™¯ã€‚

ä»”ç»†æƒ³æƒ³ï¼Œå¦‚æœä½ é‡‡ç”¨ä¸‰å±‚æ¶æ„æ¥æ­å»ºä½ çš„é¡¹ç›®ï¼Œè¿˜æœ‰ä»€ä¹ˆåœºæ™¯ä¹Ÿæ˜¯ç»“åˆæµ‹è¯•çš„åœºæ™¯ï¼Ÿ

## æ›´å¤šçš„ç»“åˆæµ‹è¯•

æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚

## å†™åœ¨æœ€å

* æˆ‘æ˜¯ Chuck1snï¼Œä¸€ä¸ªé•¿æœŸè‡´åŠ›äºç°ä»£ Jvm ç”Ÿæ€æ¨å¹¿çš„å¼€å‘è€…ã€‚
* æ‚¨çš„å›å¸–ã€ç‚¹èµã€æ”¶è—ã€å°±æ˜¯æˆ‘æŒç»­æ›´æ–°çš„åŠ¨åŠ›ã€‚
* ä¸¾æ‰‹ä¹‹åŠ³çš„ä¸€é”®ä¸‰è¿ï¼Œå¯¹æˆ‘æ¥è¯´æ˜¯è«å¤§çš„æ”¯æŒï¼Œéå¸¸æ„Ÿè°¢ï¼
* å…³æ³¨æˆ‘çš„è´¦å·ï¼Œç¬¬ä¸€æ—¶é—´æ”¶åˆ°æ–‡ç« æ¨é€ã€‚

PSï¼šä»¥ä¸Šæ‰€æœ‰ä»£ç ç¤ºä¾‹ä½ éƒ½å¯ä»¥åœ¨ [Github ä»“åº“](https://github.com/ccmjga/mjga-scaffold)ä¸­æ‰¾åˆ°ã€‚å¦‚æœæœ‰å¸®åŠ©ï¼Œè¯·é¡ºæ‰‹ç‚¹ä¸€ä¸ª Star è¿™å¯¹æˆ‘æ˜¯å¾ˆå¤§çš„é¼“åŠ±ã€‚è°¢è°¢ï¼
